<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<Title>Star diameter Analyser</Title>
</HEAD>

<BODY BGCOLOR="#FFFFDF" TEXT="#000000">



<H1>Star diameter analyser</H1>

The light curve of an asteroidal occultation can be affected by the star diameter. The Star diameter analyser is designed to fit theoretical light curves based on an assumed stellar diameter, to plural observed light curves - thereby deriving the stellar diameter and the point in the light curve corresponding to the mid-point of the star's diameter.

<H2>Theoretical basis</h2>

The light curve is derived as the ratio of the area of a segment of a circle to the area of the whole circle. This approach assumes:<ul>
<li>the stellar disk has minimal limb darkening or sunspots; and
<li>the occulting edge can be approximated as a straight line edge.</ul>

The methodology involves measuring the motion of the star perpendicular to the limb of the asteroid, from the plot of the occultation results - for each observer who has a measured light curve - to derive a theoretical light curve for each event given an assumed stellar diameter. The light curves for each observer are pasted into the analyser from the CSV file generated by LiMovie or Tangra. For each light curve a theoretical light curve is fitted on the basis of adjusting the mid-time of the event, and the star's diameter - resulting in a set of independent determinations of the stellar diameter. The final value of the stellar diameter is derived as a weighted mean of the individual determinations - with the weighting incorporating the uncertainty of the limb slope of the asteroid, and the quality of the fit of the theoretical light curve to the observed data.

<p><font color= Red><B>IMPORTANT</B> The theoretical light curve used in the analyser 
assumes the star's diameter is significantly smaller than the apparent diameter 
of the asteroid - such that the occultation can be approximated as a straight 
edge passing in front of the star. If the star's apparent diameter is more than 
about 10% of the asteroid's apparent diameter, this assumption breaks down - and 
the results become less reliable. If the star's apparent diameter is more than 
about 30% of the star's diameter, the results of the analysis will be 
unreliable.<Font Color=Black>

<H2>Inputting the data</h2>
To use the analyser, you must provide the rate of motion of the star in a direction normal to the asteroid's limb at the point of contact, and the light curve data.
<h3>Adding the normal motion</h3><ol type=1>
<li>For the particular asteroidal occultation, display the plot of the observations
<li>Under the menu item <B>Plot options...,</B> check the item at the end <B>Show star diameter analyser</B>. [<B>Note</B>. This must be checked in order for data from the plots to be transferred to the analyser.]
<li>For a particular observer, place the cursor on the D point. {When the cursor is located at that point, the name of the observer (and the event time) is displayed in the menu bar above the plot.} Now hold down the left mouse button and move the cursor. This will result in a line appearing which can be dragged around. Drag the line into an orientation that is tangential to the limb of the asteroid at the point of the occultation - using your eye to estimate the location of the limb having regard to the adjacent observers. The Tooltip box will show you the orientation and normal rate of motion corresponding to the line position. When you are happy with the location of the line, release the mouse button. This will result in the normal motion, and the observer's name and event time, being transferred to the relevant part of the Star diameter analyser.
<li>Now move the line around, and estimate the uncertainty in the value of the Normal rate of motion - and select the appropriate value range from the 'uncertainty' drop-down box next to where the normal rate of motion has been inserted. This value sets a weight to be used in the star diameter analysis. 'Unusable' gives a weight of zero while &lt10% corresponds to a weight of 4.
<li>Repeat the previous two steps for the R point of the observer.</ol>

<H3>Adding the light curve data</h3><ol type=1 start=6>
<li> now open the CSV file containing the light curve of that observer. You must open the CSV file in a text editor, and not in Excel or other spreadsheet. You should see a series of lines with a large number of commas. Make sure the text editor displays each line without any word-wrapping.
<li>scan through the csv file data to identify the approximate location of the D event. </ul>
The relevant data is usually in the 10th column (that is, the column after the 9th comma in each row) of the csv file generated by LiMovie, or the 3rd column of the csv file generated by Tangra. However it will be in column 11 or 12 of Limovie, or column 5, 7 or 9 of Tangra, if the measurement was made using an aperture other than the 'first' aperture to measure the occulted star.</ul>
Look for where the values start to drop. Now go back about 20 or 30 lines (it must be at least 10) lines, highlight from that line to about 20 or 30 lines past the end of the D part of the light curve, and Copy. [Note - the analyser will handle up to 600 lines from the CSV file - enough to cover 10 seconds of fields from an NTSC recording.]
<li>now go to the star diameter analyser, and click the button 'paste D csv data'. In the form displayed, check whether LiMovie or Tangra was used, and the object number (which will usually be #1) so that the csv file can be correctly read. Click OK, and the data will be pasted into the analyser, and the light curve plotted in the D box.
<li>repeat this process with the R part of the light curve - this time clicking the  'paste R csv data'.
<li>Note that the order of pasting the data, or computing the limb motion, does not matter. 
<li>At the right-hand side of the analyser form, set the following parameters for the particular video:<ul>
<li>
	<li>set the frame (or field) rate of the video. For PAL the value is 25 for 
	a single-frame recording &amp; 50 for filed recording. For NTSC it is 29.98 for 
	frame and 59.96 for field. If the camera is operating in integrating mode, 
	or a different number of images per second, specify the relevant value.</li>
<li>if the event did not involve a complete disappearance of the star, check the <B>Partial event </B>box.
<li> if the star image was saturated to some degree, select the saturation level relevant to the saturation of the full-light star image.</ul>
<font color=red>You <B>MUST </B>ensure the frame rate is correct for each data 
set pasted from a CSV file. Importantly the required rate is (1/image interval)<font color=black></ol>
At this stage you have some data in the analyser that can be processed. However to avoid inadvertent overwriting of the data, you will want to add the data as a specific observation record. To do this, click the <B>Add as new record </B>button at the bottom right. This will copy the displayed data into an internal memory location, and the name of the observer will appear in the list box under that button. When this is done the data for that observer can be retrieved merely by clicking the observer's name in that box. You will also want to save the data, so that it can be retrieved at a future session without having to repeat the above steps - by clicking the menu item File... Save.

<ol type=1 start=13><li>
Now proceed to add the data for other observers, to create a complete set of light curve data from which to analyse the star diameter effects. Remember to save the data periodically....!</ol>

<h2>Adjusting the light curve data</h2>
The data in the light curves needs to be calibrated, with a measurement region being set. Underneath the light curves there is a region called 'Calibrate D (R) curve', with three settings. You need to specify the region of data to be used for each oif the three regions. To do this:<ul type=1>
<li>In the Plot Controls box at the right of the form - set the 'Seconds to display' to a value sufficient to display the whole light curve.
<li>with the Set measurement region being selected, place the cursor on the plot to one side of the part of the light curve where the light level drops, and drag the cursor across that region. When the cursor is released, the region will be colour light yellow, and the frame numbers will appear in the boxes.
<li>with the <B>Set Top Level </B>option set, use the cursor to select the region of the light curve corresponding to full light . On release the region will be marked by dotted lines, and the frame numbers will appear in the boxes.
<li>with the Set bottom Level option set, use the cursor to select the region of the light curve corresponding to minimum light. On release the region will be marked by dotted lines, and the frame numbers will appear in the boxes. NOTE. In general, the minimum light level will not be zero light - as light from the asteroid may be present. That is, the Minimum light level is generally the region at the bottom of the light curve. However if the star did not completely disappear, do not set the minimum light level. Rather, ensure the <B>Partial Event </B>box is checked.
<li>Now click the <B>Calibrate levels </B>button. This will adjust the light curve so that the average minimum value is aligned with 'zero', and the full light level is aligned with '1'. <B>NOTE </B>Do not repeatedly do this calibration - as loss of precision will slowly build up.</ul>
You can adjust the time span covered by the plot with the <B>Seconds to Display </B>box at the right of the form. You can also adjust the vertical height of the plot from the <B>Plot scale </B>box at the right of the form. The values specified here are retained for each observer record.

<p>If you haven't previously added the data as a new record, do so now. Otherwise click <B>Update this Record </B>to update the data that is stored for this record.

<p>You can at any time add a text comment about the observation using the Comment box. The comment might, for example, be a reminder of a problem with the data
<P><font color=red><B>IMPORTANT</B>. Changes you make to the displayed data are only retained if the internal data is 'updated' by clicking the <B>Update this Record</B> button.<font color=black>. 

<h2>Fitting the light curve</h2>
Under each light curve there is a box called Solve D (R). This contains the tools required to fit the theoretical light curve to the observed data. This box contains the following elements:<ul type=a>
<li> A box to change the mid-frame of the data being plotted - with the corresponding frame number in the csv file being indicated. Clicking this control moves the data points left/right.
<li>a box to adjust the diameter of the star - and hence vary the shape of the light curve so that it corresponds to that star diameter. Next to that box is a check box - when checked, clicking the 
diameter control results in a change of 0.10mas rather than 0.01mas - making course adjustment easier.
<li>a box to set the weight to be used in association with this chord fit - on a scale of 0 to 5<li>
	a check box (top right of the form) to select whether a crude limb darkening 
	is applied.</ul>
</ul>Below these boxes are 4 display items, as follows<ul tupe=i>
<li>a display of the chi-squared values of the fit of the data points in the <B>measurement region </B>to the theoretical light curve. This display shows the chi^2 values for changes of +/- 1 unit in the mid-frame vale, and +/- 0.10mas in the value of the stellar diameter. The optimal fit of the light curve to the observed data results in the Chi^2 value being at a minimum for the selected point. That is, the chi^2 value for both the -1 and +1 offsets should both be larger than the value for the 0 point, and the values for the +1 and -1 should be broadly equal.
<li>a text value of the standard deviation of the raw data as compared to the theoretical light curve. The smaller this value, the better the fit.
<li>a plot (in yellow) of the O-C residuals against the normal curve for the above standard distribution.  The plot is a count of the residuals in bins of 0.05 units - noting that the 
full height of the curve is 1 unit. For a good light curve, the shape of the plot of the residuals should generally correspond to the shape of the normal distribution curve. If the plotted data is displaced to one side, the light curve is not well aligned with the observations. If the shape of the residuals is quite different to the normal curve, the reliability of the fit is expected to be poor.
<li>The expected scatter in the observed data varies with the light level. The plot in green has the residuals normalised on the basis of the expected variation in the residuals at different heights along the light curve. If the observation is reliable, the normalised residuals plotted here should broadly correspond to the normal curve.</ul>

<p>The process of fitting the light curve is now one of alternately adjusting the central frame number, and the star diameter, to minimise the corresponding values in the chi^2 test - at the same time looking for a distribution of residuals that matches the normal distribution curves. When the best fit is found, allocate a weight to it using the relevant box. Note that a weight of zero excludes that event from the star diameter solution. Use weight 5 only for clearly defined light curves with a small SDev value (that is, a narrow red normal curve on the yellow plot).

<h2>The star diameter calculation</h2>
The star diameter calculation is repeated whenever records are added or updated in the analyser.
<p>The calculation provides a weighted mean, and weighted standard deviation of the average, of the individual diameter determinations. To incorporate both the uncertainty in the limb slope of the asteroid, and the goodness of the fit, the weight used to compute the average is the product of the weight derived from the uncertainty in the normal rate of motion, and the weight associated with the fit of the light curve to the observations.


<h2>Generating a combined plot</h2>
A plot of the light curves for all observers can be generated using the <B>Plot all </B>button in the Plot controls. This allows for an easier comparison on the light curves for all observers, and an assessment of whether the star diameter value is appropriate for all observations. This plot can be generated as a series of relatively small plots, or of large plots, using the relevant radio buttons. The combined plots can be copied or saved using the <B>with Diameter plots...</B> menu item.

<p>A list of the diameter solutions for each observer can be Copied to the clipboard using the menu item with <B>Diameter plots...  Copy 
diameter solutions</B> on the Star Diameter - Plot All form

<h1><br><br>Managing the data</h1>
The data used in the analyser is held in memory in accordance with the observer's identity for the particular observation. <ul>
<li>When the data for an observer has been inserted into the form, it is placed into the analyser's memory by clicking the 'Add as new record' button
<li>The data for an observer is displayed by selecting the observer in the list of observers at the bottom right of the form.
<li>The data for an existing observer is edited by firstly displaying the observations on the form (by selecting the observer. Then edit the data as required (which may include a fresh pasting of the light curve from the CSV file, or the normal motion from the plot of the asteroid observations. Finally, update the data in memory by clicking the 'Update the record' button.
<li>The data for an existing observer may be deleted from memory by first selecting the observer (which will display the data for that observer) and then click the 'Delete the Record' button.
<li>The data may be saved in a text file using the menu item File... Save data, or File... Save data as... 
<li>All data can be removed from memory in the analyser using the menu item File... New.
<li>A saved set of data can be loaded using the menu item File... open.
<li>An image of the form showing the plots and settings for the selected observer can be saved using the menu item File... Copy entire form as an image - and pasting that into an image editor such as Paint.
</ul>
  
<h2>Format of the file for the data</h2>
The file format for the file of data for the star diameter analyser is <A  href="FileFormat%20StarDiameterAnalysis.htm"> here.</a>

<h1><br>Issues that can affect the light curve</h1>
<h2>Noise, and a visual match to the light curve</h2>
Most video light curves are characterised by low noise at low light levels, and much larger noise at high light levels. When fitting the theoretical light curve to the plotted light curve, care needs to be taken to not be misled by large noise signals immediately adjacent the light curve transition. In particular such noise signals can give a visual appearance suggesting the best-fit light curve is lower than it should be having regard to the data points in the light curve in the rise/fall region alone. Avoid this issue by 
focusing on the chi^2 values when doing the fit.

<h2>Gamma</h2>
If the recording is made with a gamma significantly different from 1, the observed light curve will have a slope that is different to the theoretical light curve. The important issue to remember when fitting the light curve is that while the slope might be different, the start and end point should be the same. However noise will usually prevent a precise determination of the end point at the high light level part of the light curve.

<h2>Limb slope irregularities</h2>
The theoretical light curve as derived on an assumption that the actual edge of the asteroid that crosses the star is generally aligned with the estimated orientation of the asteroid's limb. Situations where this may not be a reliable assumption include:<ul>
<li>large changes in the asteroid profile close to the relevant point; and
<li> the occultation occurs somewhat near a grazing limit - typically, if the duration of the observed occultation is less than 40% of the maximum duration. In this situation the star will have a significant component of motion along the limb of the asteroid - invalidating the approximation of the limb being linear
</ul>

<h2><br><br>Effects of Saturation when using Aperture photometry</h2>
When a video is measured using Aperture Photometry, any saturation of the star image in the recording will affect the shape of the light curve. If there is any possibility that saturation might exist for the measured star or any comparison stars, make sure the video is measured using PSF (Point Spread Function) photometry, as PSF photometry 'properly' deals with any issues associated with image saturation. [On the other hand, PSF photometry should be avoided when the signal from the star is weak (i.e. star is hard to see in the video) as it will have insufficient data to fit a 
Gaussian curve to the pixels representing the star image.]

<p>The effect of image saturation when using aperture photometry is as follows:<li>
At low light levels, the light curve will vary in accordance with the variation in light intensity
<li>When the central part of the stellar image reaches saturation, further increases in light intensity will be less than the actual variation in light intensity
<li>As the extent of saturation increases, the percentage area of the stellar region that is limited by saturation increases - such that the rise in the light curve becomes less and less for a fixed increase in actual brightness.
<li>However the stellar image will always include regions which are below the saturation threshold. As a result the light curve will show increases of light level while ever the light intensity is actually increasing.</ul>

<p>The effect of saturation is shown in the following three diagrams. The first diagram shows the light distribution of a recorded star image, assuming saturation occurs at a certain percentage of maximum light level.</p>
<img src="Saturation%20levels.png">
<p>The next diagram shows the effect of saturation on a light curve. For this purpose, the light curve has a linear reduction in brightness over time. The vertical scale shows the light level as a fraction of the 'true' light level if saturation had not been present.</p>
<img src="Saturation%20true%20level.png">
<p>This last diagram compares the light curves with the 'full-light' light levels (as affected by saturation) being at the same level.</p>
<img src="Saturation%20relative%20level.png">

<p>The net result is that the light curve represents the real light variation at the bottom light levels, but has a reduced light variation at highlight levels.  Importantly, the 'apparent' rate of change in brightness at the lower level appears greater when saturation is involved, but the duration of light variation is unchanged from the actual light variation. The consequences of this are:<ul>
<li>When saturation is present, the mid-time for reporting the event is not at the 50% light level - but at some higher light level (see the 3rd diagram above). Note, however, that  the mid-time is always mid-way between the start and end of the light level change.
<li>The theoretical light curve slope/shape should provide a good fit at the lower levels of the observed light curve - combined with the duration of the light curve variation.
<li>At the upper levels of the light curve, the significant issue is whether the start/end of the theoretical and observed light curves correspond in time. Unfortunately this will typically be very difficult to assess because of the noise in the observed light curve.</ul>
If a reliable stellar diameter can be derived having regard to other observations (as well as the bottom part of the light curves of saturation-affected observations), and the limb orientation at the location of a saturated-affected observation is reasonably well defined (and not near-grazing), the event time for that observation can be corrected to remove the effects of saturation - by fitting the observations at the bottom part of the light curve to the theoretical light curve. The displayed frame number identifies the frame which should be used for reporting the event time.

</BODY>
</HTML>
