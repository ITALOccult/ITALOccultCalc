<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<Title>Create Gaia-based catalogue</Title>
<style type="text/css">
.auto-style2 {
	color: #FF0000;
}
.auto-style3 {
	border: 1px solid #000000;
	text-align: left;
}
.auto-style4 {
	border: 1px solid #000000;
	text-align: center;
}
.auto-style5 {
	border: 3px solid #800000;
}
.auto-style6 {
	font-family: "Courier New", Courier, monospace;
}
.auto-style7 {
	border: 1px solid #000000;
	text-align: left;
	font-family: "Courier New", Courier, monospace;
}
.auto-style8 {
	border: 1px solid #000000;
	text-align: left;
	font-family: "Courier New", Courier, monospace;
	font-size: medium;
	background-color: #BBFFF5;
}
.auto-style9 {
	border: 1px solid #000000;
	text-align: left;
	font-size: medium;
	background-color: #BBFFF5;
}
</style>
</HEAD>

<BODY BGCOLOR="#FFFFDF" TEXT="#000000">



<H1>Create Gaia-based catalogue from TAPVizieR output</H1>
<P>This functionality is designed to create a catalogue based on Gaia
<P>The process involved is:<ul>
<li>Create and execute a number of ADQL queries in TAPVizier, to extract the 
desired data fields from the selected catalogue
<li>Download the .csv files that are generated by TAPVizieR
<li>Select the downloaded files that will make up the catalogue
<li>Match the fields in the downloaded data to the fields in the catalogue that will be created
<li>Select a name for the catalogue to be created; and
<li>Create the catalogue</ul>

<p>Each of these steps will be explained separately

<H2>1. Using TAPVizieR to obtain the required data</h2>
The first tab of the form for creating a Gaia file provides all the required 
ADQL queries<br>
<br>
<img src="GaiaCreate_1.PNG" width="600">
<br>
<p>These queries are based on the <strong> TAPVizieR </strong>tool at <strong> VizieR</strong>, available at <font color = blue><U>
<a href="http://tapvizier.u-strasbg.fr/adql/">http://tapvizier.u-strasbg.fr/adql/</a></U></font>.&nbsp; 
The data can also be downloaded from <strong>The European Space Agency's Gaia Archiv</strong>e, <a href="https://gea.esac.esa.int/archive/">esa Gaia Archive</a> 
- however you will need to change the FROM line; also the download is much 
larger due to formatting issues.</p>
<p>
You need to download all three files. That is, TychoGaia, Hipparcos, and 
Gaia_EDR3. And you must place all teh fiels in the same directory (which can be 
anywhere that is convenient).</p>
<p>The ADQL's listed on this tab are expressly relevant to the creation of a 
general catalogue. However when making your own catalogue(s), you can add extra 
search terms in the ADQL query. These all go after the line <strong>FROM</strong>, 
and before the <strong>ORDER</strong> line. The three examples give:</p>
<p>How to limit the catalogue to a range in Right Ascension. Note that the range 
must be specified in degrees (not hours)</p>
<p>How to limit the catalogue to a magnitude range. If used, this should replace 
the existing Gmag line</p>
<p>How to use latitude from the ecliptic as a criterion. You could use a similar 
line to limit the catalogue on the basis of ecliptic longitude (the parameter is 
ELON ) However if you use ecliptic coordinates as a selection criterion, and 
need to split the search into several downloads/files, you must split the search 
on the basis of the declination criterion - to avoid a serious problem when 
combining the files at the catlogue creation stage.</p>
<p><strong>NOTE</strong> when a line involves two numbers, always put the 
smaller number number first. </p>
&nbsp;<h2>2. Select the downloaded files that will make up the catalogue</h2>
<p>This is done on the 2nd tab of the form for creating the Gaia file.</p>
<br>
<img src="GaiaCreate_2.PNG" width="600">
<br>
<p>&nbsp;</p>
&nbsp;<p>The first step is to set the directory containing all the files you 
have downloaded. Use the <strong>Select Directory</strong> button to locate and 
set the directory.<p>The second set is to select the files you are going to use 
to create your file. This is done by clicking the <strong>Select .csv files</strong> 
button; this opens up the usual Windows for for selecting files. Select all the 
files relating to the particular search criteria that you want to combine. DO 
NOT select the TychoGaia or Hipparcos files - they will be accessed 
automatically.<p>The program will check to confirm the headers for each of the selected CSV files are the same. If there are any differences from the header of the first file, you will get a warning message listing all the files that are different. The two principle causes for differing headers are (i) selecting an incorrect file, and (ii) a variation in the ADQL query between the several files downloaded. If you have differences in the headers, do not 
proceed until the headers of all files you are using are the same - by re-doing one or more of the TAPVizieR queries. (Do not edit the header line 
in the file, as that willnot change the order of the data items in the file.)

<p>The files will now be listed in tables giving the file name, the most northerly declination, and most southerly declination. <br>
<font color=red><B>IMPORTANT</B></font>. The most northerly and southerly declinations are assessed on the basis of the first 500 entries in the file. For files located near the poles, this will often be insufficient to detect stars close to the pole. Do not be concerned if the northerly declination is displayed as 87deg, or the southern declination as -87 deg. However if there are gaps in the declinations between files - you should review your TAPVizieR search criteria.
<p>The program processes multiple source files by working through the files in 0.5 deg bands of declination, from north to south. The fist band is from +89.5 to +90 deg. the last band is from -90 to -89.5. A file is read until the southernmost limit is reached - and then the next file is read - and so on. Gaps in declination 
before, between, or after, files are acceptable if that is planned. If the files overlap in declination, anything in the 2nd file north of the southern limit of the previous file will be ignored. 
[For this reason, a search based on ecliptic latitude or longitude needs to 
retain a criterion based on declination.]<p>The processing assumes that the source files are ordered from northernmost to southernmost. On initial loading the files are sorted on that basis. However that ordering can be manually changed using the buttons below the file list (in the unlikely event this is required.)
<p>For specific searches you may want to limit a search in both declination and right ascension - using the <B>WHERE... between </B>constraint for both Declination and Right 
Ascension. In this situation:<ul type =a>
<li>Avoid overlap in the declination bands (See above for the processing consequence)
<li>The RA range can be different between the declination bands - with this being easiest to achieve using separate Queries for the different declination bands
<li>If you want to have several discrete RA ranges in a declination band - you will need to develop a suitable <B>WHERE... between </B>construct to achieve this, as those several RA ranges must be contained in a single file for the relevant declination band.</ul>


<h3>2a. Match the fields in the downloaded data to the fields in the catalogue that will be created</h3>
This step is critical. However if you follow the ADQL queries as provided on Tab 
1, the data in the downloaded file will already be in the correct order, and the 
following steps should not be required.<br>The middle tables in the form list the fields in the downloaded files, and the fields in the file that is going to be created. You need to move the fields in the right-hand column (using the buttons below the table) to match those in the left hand column. If there is a field in the left column that does not correspond to one in the right, move a <B>-1</B> to align with it. If there are more data items in the right column than the left - do not be concerned; those extra data items will be set to zero values.
<p><font color = red><B>CRITICAL</B>. Before proceeding to create the catalogue - double check to make sure you have correctly matched the items.</font> 
The ordering of the data items in the ADQL search query becomes relevant here - 
as it is much easier/more reliable to match the fields if they are in the same 
order (at least, approximately).

<h2>3. Create the catalogue</h2>
<p>This is done on the 3rd tab of the form for creating the Gaia file.<p>&nbsp;
<br>
<img src="GaiaCreate_3.PNG" width="600">
<br>
<p>&nbsp;<h3>3a. Select a name for the catalogue to be created</h3>
You can choose any name you like for the catalogue you have created. However avoid using 
the names listed in the <strong>Existing Gaia files</strong> list - as these names are used for files distributed as part of Occult.
<p>All the catalogues created by this tool are located in the same directory { Occult 4 / Resource Files/Gaia }.  
Following creation of the file, it is immediately available for use by Occult.&nbsp; 

If you have the full UCAC4 catalogue on your computer and accessed in Occult, 
you can match the catalogue to UCAC4 to insert UCAC4 identifiers (and for a 
small number of stars, add a proper motion using the difference in position 
between Gaia and UCAC4) .Insertion of Hipparcos and Tycho2 numbers also occurs. 
To enable UCAC4 matching, the <strong>Match to UCAC4 </strong>box must be 
checked.
<p>If you are creating a catalogue where the stars are all fainter than mag 12, 
there is no point in matching to TychoGaia or Hipparcos; indeed all stars in 
those catalogues will be added to your catalogue. Check the<strong> Ignore 
TychoGaia and Hipparcos </strong>box to ignore these catalogues.</p>
<p>&nbsp;</p>
<p>Click the <B>Create file </B>button to create the file. Progress is indicated 
in the group <strong>Processing status</strong>. The reference to<strong> Zone</strong> 
is a reference to the current 5° band being processed/created. the reference to
<strong>Band</strong> is a reference to the UCAC4 band of 0.2° being considered 
for matching.<p>After the catalogue creation has finished, there will be a short 
pause while a file containing an index for each Hipparcos star is created.<p>At 
the end of the process, 4 files will be created:<ul>
	<li>your catalogue file, with the name you have specified, and ending with
	<strong>_EDR3.bin</strong></li>
	<li>an index file for that catalogue, with the name you have specified, and 
	ending with <strong>_EDR3.inx. </strong>This file has a fixed length of 
	519,840 bytes. It gives the record number of stars at 4min intervals in RA 
	for each 0.5° zone.</li>
	<li>An index file for Hipparcos stars, having the name <strong>Hipparcos_</strong> 
	preceding the name you specified, and <strong>_EDR3.dat</strong> after. This 
	gives the record number for each Hipparcos star in the file, and has a fixed 
	length of 481,616 bytes.</li>
	<li>A statistics file, <strong>.... _EDR3_Stats.txt</strong>, containing the 
	final statistics of the file just created.</li>
</ul>
<p>The files will be created in the directory  <B>Occult 4/Resource Files/Gaia/
</B><p>To access the catalogue using a UCAC4 number as the star identifier, you 
will need a relevant index file. If you have the UCAC4 catalogue on your 
computer, you can create the required file under the <strong>Repair</strong> 
group.<h3>3b. Creating a file covering multiple discrete regions</h3>
It is possible to create a file having multiple discrete regions of stars. This requires some planning in the TAPVizieR searches. You need to identify the various regions you want to cover. Then construct a series of TAPVizieR searches in a series of relevant declinations, specifying multiple RA ranges as required in those declination ranges. Run and download the search results - then simply create the file using those source files. The resulting file will be fully functional in Occult for searching for events in the several discrete fields covered by the file. You will be able to view the location of those fields when you select that Gaia catalogue in Occult.
<span class="auto-style2"><br><br></span>
<h3>3c. Create a subset of a Gaia file</h3>
<p>This function creates a magnitude-limited subset file of a selected Gaia 
file, with all star details coming from the selected Gaia file. The magnitude 
selection is based on the G magnitude being brighter than the magnitude specified 
by the <strong>Set faint magnitude limit.</strong> as the Limiting magnitude. The range 
of limiting magnitudes that can be selected is 6 to 20. (Values of 16 and 
greater are only relevant for users who create their own catalogue for a small 
region of the sky, and want to create a magnitude-limited subset.) A subset file 
is smaller than the original file, and can result in much faster searches. The 
name of the file that is created is the name of the selected file with the 
selected magnitude being inserted after <strong>Gaia</strong> eg <strong>Gaia13.5_EDR3</strong> for a subset of 
stars to mag 13.5. </p>
<p>&nbsp;</p>
<h2>4. Viewing the catalogue</h2>
When the catalogue is created, it will appear as an entry in the list for 
<strong>Existing Gaia Files.</strong> Click on an entry and a colour map of the star density distribution in the catalogue will be displayed. The colors go from Black (no stars) to light yellow (highest star density). The color scale is relative, based on the <I>portion of the sky in the catalogue </I>that has the highest number of stars. Thus a whole-sky catalogue will clearly show the Milky Way in light yellow. However when a catalogue is limited to a section of the sky located away from the milky way, its area of highest star density will also be set to light yellow.
<br><br>You can also view the details of the catalogue using the usual option on 
the <strong>Maintenance</strong> tab of Occult - <strong>View catalogue details 
for a range of stars<br></strong>
<br>
<h2>5. Gaia16_EDR3 catalogue - statistics</h2>

<p>The Gaia16_EDR3 catalogue has been created on the following basis:</p>
<ul>
	<li>Includes all stars in Gaia DR3 where either the G magnitude (effectively 
	V magnitude), is brighter than 16.00</li>
	<li>For any stars with no proper motion in Gaia EDR3, a flag was added</li>
	<li>The TychoGaia catalogue, and Hipparcos2 catalogue, were used to
	<ul>
		<li>add a Hipparcos or Tycho2 identifier in Occult - using positions 
		from Hipparcos and TychoGaia referred to the Gaia EDR3 epoch </li>
		<li>add stars that were in TychoGaia (preferred) or Hipparcos2 that were 
		not included in Gaia EDR3.</li>
	</ul>
	</li>
	<li>The processing was conducted in 0.5-deg bands of declination. </li>
	<li>Matching stars without a Hipparcos or Tycho2 identifier with the UCAC4 
	catalogue - using the Gaia EDR3 position at the J2000 epoch of UCAC4 - for 
	the following purposes<ul>
		<li>Where the positions agreed to within 0.2&quot;, the UCAC4 identifier was 
		added, with a flag to indicate it was a good match</li>
		<li>Where the positions agreed to within 1.0&quot;, the UCAC4 identifier was 
		added, with a flag to indicate it was a poor match</li>
		<li>Where there was a match, but the Gaia EDR3 position did not have a 
		proper motion, a proper motion was calculated using the J2000 UCAC4 
		position and the Gaia EDR position for its 2016.0 epoch - with a flag 
		added</li>
		<li>Where two sequential stars were matched to a single UCAC4 star, the 
		identification (&amp; any added proper motion) was removed on the basis of 
		lack of proper motion in EDR3, whether one star had a good match and the 
		other a poor match, whether one star had an RUWE &lt;1.5 (but greater than 
		0.15) and the other had an RUWE &gt;2, whether the separations differed by 
		more than 0.1&quot; (the closer being retained) or the brighter Magnitude V</li>
	</ul>
	</li>
</ul>
<p>The statistics of the catalogue so generated are:</p>
<table align="center" style="width: 70%" class="auto-style5">
	<tr>
		<td class="auto-style3" style="width: 590px"><strong>Total number of 
		stars from Gaia EDR3 brighter than 16.0 Mv</strong></td>
		<td class="auto-style7" style="width: 326px"><strong>77,936,526</strong></td>
	</tr>
	<tr>
		<td class="auto-style3" style="width: 590px"><strong>Number of stars in TychoGaia</strong></td>
		<td class="auto-style7" style="width: 326px"><strong>&nbsp;2,063,800</strong></td>
	</tr>
	<tr>
		<td class="auto-style3" style="width: 590px"><strong>Number of Hipparcos stars not 
		in TychoGaia</strong></td>
		<td class="auto-style7" style="width: 326px"><strong>&nbsp;&nbsp;&nbsp; 24,459</strong></td>
	</tr>
	<tr>
		<td class="auto-style3" style="width: 590px"><strong>Number of TychoGaia 
		stars 
		matched, and number added to catalogue</strong></td>
		<td class="auto-style7" style="width: 326px"><strong>
		<span class="auto-style6">Matched: 2,054,127</span><br class="auto-style6">
		<span class="auto-style6">&nbsp;
		Added:&nbsp;&nbsp;&nbsp;&nbsp; 9,673</span></strong></td>
	</tr>
	<tr>
		<td class="auto-style3" style="width: 590px"><strong>Number of Hipparcos 
		stars not in TychoGaia - matched, and number added to catalogue</strong></td>
		<td class="auto-style7" style="width: 326px"><strong>
		<span class="auto-style6">Matched:&nbsp;&nbsp;&nbsp; 22,536</span><br class="auto-style6">
		<span class="auto-style6">&nbsp;
		Added:&nbsp;&nbsp;&nbsp;&nbsp; 1,923</span></strong></td>
	</tr>
	<tr>
		<td class="auto-style9" style="width: 590px"><strong>Total number of 
		stars in the catalogue</strong></td>
		<td class="auto-style8" style="width: 326px"><strong>77,948,122</strong></td>
	</tr>
	<tr>
		<td class="auto-style3" style="width: 590px"><strong>Number of stars in 
		Gaia EDR3 with 
		no proper motion</strong></td>
		<td class="auto-style7" style="width: 326px"><strong>&nbsp;&nbsp; 573,122</strong></td>
	</tr>
	<tr>
		<td class="auto-style3" style="width: 590px"><strong>Number of stars 
		from EDR3 well matched to UCAC4</strong></td>
		<td class="auto-style7" style="width: 326px"><strong>69,143,917</strong></td>
	</tr>
	<tr>
		<td class="auto-style3" style="width: 590px"><strong>Number of stars 
		from EDR3 poorly matched to UCAC4</strong></td>
		<td class="auto-style7" style="width: 326px"><strong>&nbsp;3,441,053</strong></td>
	</tr>
	<tr>
		<td class="auto-style3" style="width: 590px"><strong>Number of stars 
		from EDR3 with proper motions added from comparing UCAC4 J2000 position 
		with EDR3 position</strong></td>
		<td class="auto-style7" style="width: 326px"><strong>&nbsp;&nbsp; 131,232</strong></td>
	</tr>
	<tr>
		<td class="auto-style3" style="width: 590px"><strong>Number of EDR3 stars not 
		matched to UCAC4</strong></td>
		<td class="auto-style7" style="width: 326px"><strong>&nbsp;3,879,395</strong></td>
	</tr>
	<tr>
		<td class="auto-style3" style="width: 590px"><strong>File size</strong></td>
		<td class="auto-style7" style="width: 326px"><strong>
		<span class="auto-style6">4,520,991,076 bytes(4.5GB)</span><br class="auto-style6">
		<span class="auto-style6">&nbsp;2.83 GB 
		zipped</span></strong></td>
	</tr>
</table>


<h2>&nbsp;</h2>
<p>&nbsp;</p>
<h3>For comparison the statistics for the Gaia14_DR2 catalogue are:</h3>
<p>The Gaia14_DR2 catalogue has been built from Gaia DR2 on the following basis:</p>
<ul>
	<li>Includes all stars in Gaia DR2 where either the G magnitude, or the R<sub>ph</sub> 
	magnitude, is brighter than 14.0</li>
	<li>The TychoGaia catalogue in Occult (corresponding to the Tgas file of 
	Gaia DR1) was supplemented with 24,707 Hipparcos stars that were not 
	included in the Tgas solution.</li>
	<li>The processing was conducted in 0.5-deg bands of declination. Stars in 
	the TychoGaia file - including the added Hipparcos file - had proper motion 
	applied to bring their epoch to 2015.5 (the epoch of DR2).</li>
	<li>Stars in DR2 were compared to the expanded TychoGaia file. </li>
	<li>Where a match was found, the star identifier in TychoGaia was 
	transferred to the DR2 record</li>
	<li>Where a star in the expanded TychoGaia was not present in DR2, that 
	record was added to the catalogue being generated. The source of such 
	entries can be determined from the epoch: DR1 stars have an epoch of 2015.0; 
	Hipparcos catalogue stars have an epoch of 1991.25.</li>
	<li>Where a DR2 star did not match a star in expanded TychoGaia, a match in 
	UCAC4 was sought. If a match was found, the UCAC4 identifier was added to 
	the DR2 record. If the match was not a close match, that fact is indicated 
	in the Catalogue Supplemental number field.</li>
	<li>Where a DR2 star had no proper motion, but a match to a UCAC4 star was 
	found, a proper motion was derived using the UCAC4 position.&nbsp; That fact 
	is indicated in the Catalogue Supplemental number field.</li>
</ul>
<p>&nbsp;</p>
<table align="center" style="width: 56%" class="auto-style5">
	<tr>
		<td class="auto-style3" style="width: 350"><strong>Total number of 
		stars</strong></td>
		<td class="auto-style4" style="width: 120">30,111,149</td>
	</tr>
	<tr>
		<td class="auto-style3" style="width: 350"><strong>Number of stars 
		matched to Tgas (2,057,050 stars + 24707 Hip stars not included in Tgas)</strong></td>
		<td class="auto-style4" style="width: 120">2,080,110</td>
	</tr>
	<tr>
		<td class="auto-style3" style="width: 350"><strong>Number of stars added 
		from TychoGaia (2,057,050 stars + 24707 Hip stars not included in TychoGaia) that 
		were not present in Gaia DR2</strong></td>
		<td class="auto-style4" style="width: 120">1166</td>
	</tr>
	<tr>
		<td class="auto-style3" style="width: 350"><strong>Number of stars 
		well matched to UCAC4</strong></td>
		<td class="auto-style4" style="width: 120">26,938,858</td>
	</tr>
	<tr>
		<td class="auto-style3" style="width: 350"><strong>Number of stars 
		poorly matched to UCAC4</strong></td>
		<td class="auto-style4" style="width: 120">237,169</td>
	</tr>
	<tr>
		<td class="auto-style3" style="width: 350"><strong>Number of stars 
		with proper motions derived using UCAC4</strong></td>
		<td class="auto-style4" style="width: 120">298,026</td>
	</tr>
	<tr>
		<td class="auto-style3" style="width: 350"><strong>Number of stars not 
		matched to UCAC4</strong></td>
		<td class="auto-style4" style="width: 120">555,820</td>
	</tr>
	<tr>
		<td class="auto-style3" style="width: 350"><strong>File size</strong></td>
		<td class="auto-style4" style="width: 120">1.34 GB <br>&nbsp;850MB 
		zipped</td>
	</tr>
</table>

<p>&nbsp;</p>
<p>&nbsp;</p>

</BODY>
</HTML>
