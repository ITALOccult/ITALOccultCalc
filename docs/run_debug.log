DEBUG: Main started.

╔═══════════════════════════════════════════════════════════════╗
║                     ITALOccultCalc v1.0                        ║
║         Ricerca Automatica Occultazioni Asteroidali           ║
║              Ottimizzato per Osservatori Italiani              ║
╚═══════════════════════════════════════════════════════════════╝
[DEBUG] main: Prima di startTime
[DEBUG] main: WORKFLOW COMPLETO - INIZIO
Initializing Global DE441 Ephemeris: /Users/michelebigi/.ioccultcalc/ephemerides/de441_part-2.bsp...
✓ DE441 loaded (Native Reader): /Users/michelebigi/.ioccultcalc/ephemerides/de441_part-2.bsp
✓ Global DE441 Loaded successfully.
[DEBUG] main: Step 1: Caricamento configurazione...
[DEBUG] loadConfiguration: INIZIO

================================================================
CARICAMENTO CONFIGURAZIONE
================================================================

File configurazione: test_ioc_earth.oop
[DEBUG] loadConfiguration: ConfigManager creato
[DEBUG] loadConfiguration: Verifico formato file...
[DEBUG] loadConfiguration: Carico OOP...
✓ Configurazione OrbFit caricata
  Auto-converting to JSON: test_ioc_earth.json ... OK
[DEBUG] loadConfiguration: File caricato, valido configurazione...
✓ Configurazione validata

[DEBUG] loadConfiguration: Configurazione validata, leggo sezioni...
[DEBUG] loadConfiguration: Chiamo getSection(PROPAGATION)...
[DEBUG] loadConfiguration: getSection(PROPAGATION) completato
[DEBUG] loadConfiguration: Chiamo getSection(SEARCH)...
[DEBUG] loadConfiguration: getSection(SEARCH) completato
[DEBUG] loadConfiguration: Sezioni lette, stampo parametri...
[DEBUG] loadConfiguration: propagSection trovata
Propagatore: RK4
Step size: 0.1 giorni
[DEBUG] loadConfiguration: searchSection trovata
Intervallo ricerca: 0.5 giorni (MJD)
[DEBUG] loadConfiguration: FINE
[DEBUG] main: Step 1: Completato
[DEBUG] Step 2: Selezione asteroidi...
[DEBUG] selectAsteroids: INIZIO

================================================================
SELEZIONE ASTEROIDI CANDIDATI
================================================================

[DEBUG] selectAsteroids: Dopo printHeader
[DEBUG] selectAsteroids: Inizializzo variabili...
[DEBUG] selectAsteroids: Leggo configurazione objectSection...
[DEBUG] selectAsteroids: objectSection letto
Criteri selezione:
  ★ LISTA ESPLICITA: 1 asteroidi [249]
  (filtri diametro/magnitudine ignorati)


[SQLite] Database allnum.db trovato. Uso lettura diretta per lista esplicita.
Data aggiornamento DB: 2025-12-14 14:43:00
[DEBUG] Forcing physical parameters for Ilse: H=7 Albedo=0.043
Trovati 1 asteroidi nel DB.
[DEBUG] Step 2: Completato, trovati 1 asteroidi
[DEBUG] Step 3: Propagazione orbite...

================================================================
PROPAGAZIONE ORBITE
================================================================

SPKReader: Successfully loaded DE441 covering JD -3.02722e+06 to 7.93019e+06
OrbitPropagator: Using JPL DE441 (high precision planets)
OrbitPropagator: WARNING - Asteroid perturbations disabled (codes_300ast_20100725.bsp not found)
[▓░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░]   0% | Propagazione   : (249) Ilse                                        [████████████████████▓░░░░░░░░░░░░░░░░░░░░░░░░░░░░░] 40 % | Propagazione   : Completata                                        
[DEBUG] Step 3: Completato
[DEBUG] Step 4: Query catalogo stelle...

=== [DEBUG] Inizio queryCatalog ===
[DEBUG queryCatalog] gaiaSection trovata: SI
[DEBUG] gaia.version letto: 'DR3'
[DEBUG] Impostato Gaia DR3

================================================================
QUERY CATALOGO STELLE GAIA DR3
================================================================


╔══════════════════════════════════════════════════════════╗
║      ★ CATALOGO MAG18 LOCALE ATTIVO ★                   ║
║  303M stelle (G≤18) - Query locale veloce               ║
║  Nessuna query online - tutto da catalogo 9GB           ║
╚══════════════════════════════════════════════════════════╝

Could not open IAU catalog: data/IAU-CSN.json
Could not open star names database: data/common_star_names.csv
Loaded 23 stars from embedded database
Loaded star names from embedded database
✓ Catalogo Gaia caricato: /Users/michelebigi/.catalog/gaia_mag18_v2_multifile
  Catalogo: Multi-File Gaia DR3 V2 | Stelle: 231140585
[DEBUG] Step 4: Completato, trovate 0 stelle
[DEBUG] Step 5: Rilevamento occultazioni...

================================================================
RILEVAMENTO OCCULTAZIONI
================================================================

Parametri ricerca:
  Periodo: JD 2.46105e+06 - 2.46105e+06
  Mag limite: 18
  Raggio ricerca: 5 gradi
  Probabilità minima: 1%

Asteroidi da analizzare: 1

Calcolo sequenziale (SPICE thread-safety)...


[1   /1] (249   ) Ilse                 - D=   0km  - Phase 1 Screening...[DEBUG] forceTargetStar loaded: TRUE

[URGENT DEBUG] === PHASE 1 INPUT CHECK ===
Propagating Input Elements to Start MJD: 61051
Elements (Ecliptic J2000): a=2.37832 e=0.2173 i(deg)=9.62091 Omega(deg)=334.653 omega(deg)=42.3634
Debug: Target star 877859914797936896 missing. Fetching manually...
Debug: Target star added manually to candidates (T0=61051.1).
[DEBUG Phase2 Phys] Passing to Phase 2: D=0 H=7 G=0.15 p=0.043

╔════════════════════════════════════════════════════════════╗
║  PHASE 2: Geometria Precisa con Orbital Refinement        ║
╚════════════════════════════════════════════════════════════╝

Candidati da processare: 1
Orbital refinement: ATTIVO
Finestra temporale: ±30 min
Risoluzione: 1 sec

══════════════════════════════════════════════════════════
STEP 1: ORBITAL REFINEMENT
══════════════════════════════════════════════════════════

  [RWO Download] Scaricamento osservazioni per 249...
  URL: https://newton.spacedys.com/~astdys2/mpcobs/numbered/0/249.rwo
  Downloading...
  ✓ File scaricato: /tmp/249.rwo
  [Debug] RWO File Size: 2039175 bytes
  Parsing RWO...
  ✓ Parsate 4588 osservazioni RWO
  [Observations] Scaricate 4588 osservazioni
  [Observations] Selezionate 200 osservazioni più recenti per il fit
  [Observations] Epoca più recente: MJD 60953.64
  [Observations] Epoca più vecchia: MJD 60609.06
  [Orbital Fit] Fitting con 200 osservazioni (AstDynEngine)...
Loading DE441 Ephemeris: /Users/michelebigi/.ioccultcalc/ephemerides/de441_part-2.bsp...
✓ DE441 loaded (Native Reader): /Users/michelebigi/.ioccultcalc/ephemerides/de441_part-2.bsp
DE441 Loaded successfully.
  [Orbital Fit] Initial Elements (Equatorial J2000) at MJD 61051.00:
    a=2.38 e=0.22 i=32.38 deg
    Node=352.32 Peri=23.82 M=58.09 deg

Initial orbit set:
  Epoch: 61051.000000 MJD TDB
  a = 2.378320 AU
  e = 0.217300
  i = 32.381846 deg
  [Orbital Fit] First Obs: MJD 60953.636008 RA=116.387242 deg Dec=30.747900 deg

=== Differential Correction ===
Observations: 200
Max iterations: 20
Convergence threshold: 0.000001

========================================
Differential Corrections
========================================
Observations: 200
Max iterations: 20
Convergence: 0.000001 AU

Iter  1: RMS = 35991.634 arcsec, ||Δx|| = 4.38e-01 AU, Outliers = 0
Iter  2: RMS = 0.000 arcsec, ||Δx|| = 1.62e-01 AU, Outliers = 200
Iter  3: RMS = 0.000 arcsec, ||Δx|| = 8.58e-02 AU, Outliers = 200
Iter  4: RMS = 0.000 arcsec, ||Δx|| = 1.05e-02 AU, Outliers = 200
Iter  5: RMS = 5.172 arcsec, ||Δx|| = 1.11e-03 AU, Outliers = 164
Iter  6: RMS = 3.756 arcsec, ||Δx|| = 1.29e-04 AU, Outliers = 10
Iter  7: RMS = 0.998 arcsec, ||Δx|| = 1.52e-05 AU, Outliers = 0
Iter  8: RMS = 0.844 arcsec, ||Δx|| = 1.83e-06 AU, Outliers = 0
Iter  9: RMS = 0.839 arcsec, ||Δx|| = 2.27e-07 AU, Outliers = 0

✓ CONVERGED after 9 iterations
========================================


=== Final Orbit (AstDyn) ===
  a=2.38e+00 AU, e=2.17e-01
  GM=2.96e-04 AU^3/day^2
Epoch:    61051.000000 MJD TDB
a:        2.378447912 AU
e:        0.217397520
i:        32.383543 deg
Ω:        352.318832 deg
ω:        23.805972 deg
M:        71.806429 deg
Period:   1339.797 days
q:        1.861379 AU
Q:        2.895517 AU

=== Residuals Summary ===
Observations:  200
Rejected:      0
RMS (RA):      0.382 arcsec
RMS (Dec):     1.123 arcsec
Chi²:          250.35
Iterations:    9
Converged:     Yes
  ✓ Fit completato in 1.37 sec
    RMS Finale: 1.19 arcsec
    N. Obs: 200 (0 outlier rimossi)

  ✓✓✓ ORBITA RAFFINATA CON SUCCESSO ✓✓✓
  Elementi propagati al CA per massima precisione

══════════════════════════════════════════════════════════
STEP 2: CALCOLO GEOMETRIA OCCULTAZIONI
══════════════════════════════════════════════════════════

Candidato 1/1 - Stella 877859914797936896...
  [Phase2 Geometry] Using refined (Equatorial J2000) elements.
  Geometria (Piano Fondamentale):
    Impact Parameter: 5441.262 km
    Earth Radius Limit: 6505.711 km
    Shadow Velocity: 11.44 km/s
    Esito geometrico: HIT (Ombra interseca Terra)
  ✓ CA: 12307.99 mas @ MJD 61051.102891
  Duration: 22.312023 sec
  Shadow path width: 255.147169 km

══════════════════════════════════════════════════════════
PHASE 2 COMPLETATA
══════════════════════════════════════════════════════════
  Orbital refinement: ✓ Successo
    RMS residui: 1.186426 arcsec
    Osservazioni: 200
  Eventi calcolati: 1
  Falliti: 0
  Tempo totale: 4899.988083 ms

Debug: Checking 1 candidates for target ID 877859914797936896

======================================================
 SPECIAL CHECK FOR STAR: 877859914797936896
======================================================
  [Phase2 Geometry] Using refined (Equatorial J2000) elements.
  Geometria (Piano Fondamentale):
    Impact Parameter: 5441.262 km
    Earth Radius Limit: 6505.711 km
    Shadow Velocity: 11.44 km/s
    Esito geometrico: HIT (Ombra interseca Terra)
  > Calculated MJD: 61051.102891
  > Closest Approach: 12307.991 mas
  > Shadow Width: 255.147 km
  > Shadow Path Points: 79
  > RESULT: HIT (Shadow path found)
======================================================


 >>> TARGET STAR FOUND: 877859914797936896 <<<
     MJD: 61051.103
     Closest Approach: 12307.991 mas
     Duration: 22.312 s
     Shadow Velocity: 11.435 km/s
     Besselian X, Y: -0.238, 0.819
 ---------------------------------------------------
 → Phase1: 0 candidati → Phase2: 1 eventi → Trovati 1 eventi! ✓
[██████████████████████████████████████████████████] 100% | Completato     : 1 asteroidi processati                            
[DEBUG] Step 5: Completato, trovati 1 eventi

================================================================
CALCOLO PRIORITÀ EVENTI
================================================================

Criteri di priorità:
  • Mag drop > 2.0 mag: +3 punti
  • Durata > 5 secondi: +2 punti
  • Path attraversa Italia: +3 punti
  • Incertezza < 15 km: +2 punti
  • Stella luminosa (< 10 mag): +1 punto

(249) Ilse vs 
  Score: 7.000/11 ★★
    • Durata significativa
    • Visibile dall'Italia
    • Path ben determinato


================================================================
GENERAZIONE REPORT
================================================================

Applicazione filtri richiesti: Mag <= 21.0, Durata > 0.0s

Formati output:
  • IOTA formato classico
  • Preston formato compatto
  • JSON per API
  • KML per Google Earth
  • CSV per Excel

╔════════════════════════════════════════════════════════════╗
║          ITALOccultCalc - REPORT OCCULTAZIONI              ║
╚════════════════════════════════════════════════════════════╝

Totale eventi trovati: 1
Eventi dopo filtri: 1

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
(249) Ilse occulta 
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Data/Ora: 2026-10-11 20:28:90 UT
JD: 2461051.602891

Geometria:
  Separazione: 12.307991 arcsec
  Mag drop: 0.008784 mag
  Durata: 22.312023 secondi
  Larghezza path: 255 km
  Incertezza: ±0 km (1σ)

Visibile da: Roma

PRIORITÀ: ★★ (7.000000/11)

✓ Report console generato

DEBUG XML: designation='249' name='Ilse' diameter=0.000000
✓ File XML generato: test_output_occult4.xml
  Formato: Occult4 compatible
  Eventi: 1
  Import in: OccultWatcher Cloud

✓ File JSON generato: test_output_structured.json
✓ File KML generato: output_events.kml
  Tracce generate: 1


=== Rendering Occultation Map ===
Calcolo estensione mappa...
Aggiunta griglia di coordinate...
Caricamento shapefile da: external/IOC_Earth/data/
Rendering limiti sigma...
Rendering margini geometrici...
Rendering linea centrale...
Rendering time markers...
Rendering stazioni osservazione...
Rendering finale...
Mapnik LOG> 2025-12-22 23:54:09: SVG parse error: can't infer valid image dimensions from width:"100%" height:"100%"

✓ Mappa occultazione generata: test_cards/event_card_map.png

Dettagli:
  Evento: 249_877859914797936896
  Asteroide: (249) Ilse
  Stella: GAIA DR3 877859914797936896
  Tempo: 2026-01-11 02:28:09
  Durata: 22.312023 secondi
  Calo magnitudine: 0.008784
  ✓ Griglia RA/Dec ogni 2.500000° visibile

================================================================
RIEPILOGO TEMPI DI ESECUZIONE
================================================================

┌───────────────────────────────┬──────────────┐
│ FASE                          │ TEMPO (s)    │
├───────────────────────────────┼──────────────┤
│ 1. Caricamento Config         │     0.000 s  │
│ 2. Selezione Asteroidi        │     0.385 s  │
│ 3. Propagazione Orbite        │     0.000 s  │
│ 4. Query Catalogo Stelle      │     0.001 s  │
│ 5. Rilevamento Occultazioni   │    32.278 s  │
│ 6. Reporting & Export         │     3.701 s  │
├───────────────────────────────┼──────────────┤
│ TOTALE                        │    36.366 s  │
└───────────────────────────────┴──────────────┘

✓ Workflow completato con successo!
Eventi trovati: 1
Report salvati in: output/

